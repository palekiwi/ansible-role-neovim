---
- name: Ensure that packer is installed
  ansible.builtin.git:
    repo: https://github.com/wbthomason/packer.nvim
    dest: ~/.local/share/nvim/site/pack/packer/start/packer.nvim
    depth: 1
    version: master

- name: Install packer configuration templates
  ansible.builtin.template:
    src: templates/lua/plugins/packer.lua.j2
    dest: "{{ plugins_dir }}/packer.lua"
    mode: "0644"
    force: true
  notify: PackerSync

- name: Copy plugin configuration files.
  ansible.builtin.template:
    src: "{{ item['config']['src'] }}"
    dest: "{{ plugins_dir }}/{{ item.config['name'] }}.lua"
    mode: "0644"
  notify: PackerSync
  loop: "{{ plugins }}"
  when: item.enabled and item.config is defined
